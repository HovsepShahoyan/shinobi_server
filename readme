
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      RTSP        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     continuous      Server â”‚
â”‚  â”‚ IP       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ SHINOBI  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Storageâ”‚
â”‚  â”‚ Cameras  â”‚                  â”‚ NVR      â”‚     recording              â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚       â”‚                              â”‚                                  â”‚
â”‚       â”‚ ONVIF                        â”‚ download every 30s              â”‚
â”‚       â”‚ Events                       â–¼                                  â”‚
â”‚       â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚       â”‚                    â”‚         YOUR PC                 â”‚         â”‚
â”‚       â”‚                    â”‚                                 â”‚         â”‚
â”‚       â”‚                    â”‚   temp_recordings/              â”‚         â”‚
â”‚       â”‚                    â”‚   â”œâ”€â”€ cam1/                     â”‚         â”‚
â”‚       â”‚                    â”‚   â”‚   â”œâ”€â”€ video_14-00.mp4       â”‚         â”‚
â”‚       â”‚                    â”‚   â”‚   â”œâ”€â”€ video_14-10.mp4       â”‚         â”‚
â”‚       â”‚                    â”‚   â”‚   â””â”€â”€ ...                   â”‚         â”‚
â”‚       â”‚                    â”‚   â””â”€â”€ cam2/                     â”‚         â”‚
â”‚       â”‚                    â”‚                                 â”‚         â”‚
â”‚       â–¼                    â”‚         â”‚                       â”‚         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚         â”‚ auto-delete           â”‚         â”‚
â”‚  â”‚  ONVIF   â”‚   motion     â”‚         â”‚ after 1 hour          â”‚         â”‚
â”‚  â”‚ Listener â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”    â–¼                       â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   detected   â”‚    â”‚   ğŸ—‘ï¸                       â”‚         â”‚
â”‚                            â”‚    â”‚                            â”‚         â”‚
â”‚                            â”‚    â”‚   BUT if motion event:     â”‚         â”‚
â”‚                            â”‚    â”‚         â”‚                  â”‚         â”‚
â”‚                            â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ move to          â”‚         â”‚
â”‚                            â”‚              â–¼                  â”‚         â”‚
â”‚                            â”‚   permanent_recordings/         â”‚         â”‚
â”‚                            â”‚   â”œâ”€â”€ cam1/                     â”‚         â”‚
â”‚                            â”‚   â”‚   â””â”€â”€ 20240115_143022/      â”‚         â”‚
â”‚                            â”‚   â”‚       â”œâ”€â”€ video_14-29.mp4   â”‚ 1 min   â”‚
â”‚                            â”‚   â”‚       â”œâ”€â”€ video_14-30.mp4 â—€â”€â”¤ before  â”‚
â”‚                            â”‚   â”‚       â””â”€â”€ video_14-31.mp4   â”‚ + after â”‚
â”‚                            â”‚   â””â”€â”€ cam2/                     â”‚         â”‚
â”‚                            â”‚                                 â”‚         â”‚
â”‚                            â”‚   (kept forever)                â”‚         â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜





# "A person crossed the entrance line going IN with 95% confidence"
curl -X POST "http://localhost:8000/event/cam1/line" \
  -d '{"line_name": "entrance", "direction": "in", "object_type": "person", "confidence": 95}'
```

---

## Simple Diagram
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚   WHO CAN SEND EVENTS:           WEBHOOK SERVER         â”‚
â”‚                                  (Your new server)      â”‚
â”‚   â€¢ Your ONVIF server      â”€â”€â”€â–¶                         â”‚
â”‚   â€¢ AI/YOLO detector       â”€â”€â”€â–¶  Receives HTTP POST     â”‚
â”‚   â€¢ Home Assistant         â”€â”€â”€â–¶  on port 8000           â”‚
â”‚   â€¢ You manually (curl)    â”€â”€â”€â–¶                         â”‚
â”‚                                        â”‚                â”‚
â”‚                                        â–¼                â”‚
â”‚                                  SHINOBI                â”‚
â”‚                                  Saves video            â”‚
â”‚                                        â”‚                â”‚
â”‚                                        â–¼                â”‚
â”‚                                  YOUR PC                â”‚
â”‚                                  Stores recordings      â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SHINOBI                                 â”‚
â”‚                                                                 â”‚
â”‚   1. CONNECTS TO CAMERAS                                        â”‚
â”‚      - Receives RTSP streams                                    â”‚
â”‚      - Handles reconnection if camera disconnects               â”‚
â”‚                                                                 â”‚
â”‚   2. RECORDS VIDEO                                              â”‚
â”‚      - Encodes/saves video files                                â”‚
â”‚      - Manages segments (splits into files)                     â”‚
â”‚      - Handles storage on server                                â”‚
â”‚                                                                 â”‚
â”‚   3. PROVIDES STREAMS                                           â”‚
â”‚      - HLS streams for web/VLC                                  â”‚
â”‚      - MJPEG for simple viewing                                 â”‚
â”‚      - Live view in browser                                     â”‚
â”‚                                                                 â”‚
â”‚   4. WEB INTERFACE                                              â”‚
â”‚      - View cameras live                                        â”‚
â”‚      - Playback recordings                                      â”‚
â”‚      - Configure cameras                                        â”‚
â”‚                                                                 â”‚
â”‚   5. MOTION API                                                 â”‚
â”‚      - Receives "motion detected" triggers                      â”‚
â”‚      - Marks recordings as events                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      OUR WEBHOOK SERVER                         â”‚
â”‚                                                                 â”‚
â”‚   1. RECEIVES EVENTS                                            â”‚
â”‚      - HTTP webhooks from any source                            â”‚
â”‚      - Rich metadata (person, car, zone, etc.)                  â”‚
â”‚                                                                 â”‚
â”‚   2. TELLS SHINOBI TO SAVE                                      â”‚
â”‚      - Calls Shinobis motion API                               â”‚                      â”‚
â”‚                                                                 â”‚
â”‚   3. DOWNLOADS TO YOUR PC                                       â”‚
â”‚      - Copies recordings from Shinobi to local disk             â”‚
â”‚      - Shinobi stores on server, we copy to YOUR PC             â”‚
â”‚                                                                 â”‚
â”‚   4. MANAGES LOCAL STORAGE                                      â”‚
â”‚      - temp_recordings/ (deleted after 1 hour)                  â”‚
â”‚      - permanent_recordings/ (kept forever)                     â”‚
â”‚                                                                 â”‚
â”‚   5. SAVES EVENT METADATA                                       â”‚
â”‚      - event_info.json with detection details                   â”‚
â”‚      - What Shinobi CANT do                                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
